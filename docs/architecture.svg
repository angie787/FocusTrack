<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1140 520" font-family="Segoe UI, sans-serif" font-size="12">
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <path d="M0,0 L8,4 L0,8 Z" fill="#333"/>
    </marker>
    <style>
      .box { fill: #e8f4f8; stroke: #2d6a9f; stroke-width: 1.5; rx: 4; }
      .infra { fill: #f0f0f0; stroke: #666; stroke-width: 1.5; rx: 4; }
      .queue { fill: #fff3e0; stroke: #e65100; stroke-width: 1.5; rx: 4; }
      .label { fill: #111; font-weight: 600; }
      .sublabel { fill: #444; font-size: 10; }
      .flow { stroke: #1976d2; stroke-width: 1.5; fill: none; marker-end: url(#arrow); }
      .flow-msg { stroke: #6a1b9a; stroke-width: 1.5; fill: none; marker-end: url(#arrow); stroke-dasharray: 4 2; }
      .tbl-title { fill: #111; font-weight: 600; font-size: 11; }
      .tbl-row { fill: #333; font-size: 10; }
    </style>
  </defs>
  <!-- Title -->
  <text x="400" y="22" text-anchor="middle" class="label" font-size="14">FocusTrack – High-level architecture</text>

  <!-- Client -->
  <rect x="340" y="40" width="120" height="48" class="box"/>
  <text x="400" y="58" text-anchor="middle" class="label">Client (browser / Postman)</text>
  <text x="400" y="74" text-anchor="middle" class="sublabel">Bearer or cookie auth</text>

  <!-- Gateway -->
  <rect x="340" y="96" width="120" height="48" class="box"/>
  <text x="400" y="118" text-anchor="middle" class="label">Gateway (BFF)</text>
  <text x="400" y="132" text-anchor="middle" class="sublabel">OIDC, Cookie/Bearer,</text>
  <text x="400" y="142" text-anchor="middle" class="sublabel">reverse proxy</text>

  <!-- Keycloak -->
  <rect x="120" y="168" width="100" height="40" class="infra"/>
  <text x="170" y="188" text-anchor="middle" class="label">Keycloak</text>
  <text x="170" y="200" text-anchor="middle" class="sublabel">OIDC (auth)</text>

  <!-- Session API -->
  <rect x="320" y="168" width="160" height="52" class="box"/>
  <text x="400" y="188" text-anchor="middle" class="label">Session API</text>
  <text x="400" y="202" text-anchor="middle" class="sublabel">Sessions, sharing, admin,</text>
  <text x="400" y="214" text-anchor="middle" class="sublabel">outbox</text>

  <!-- Postgres Sessions -->
  <rect x="320" y="244" width="160" height="44" class="infra"/>
  <text x="400" y="262" text-anchor="middle" class="label">PostgreSQL (sessions)</text>
  <text x="400" y="276" text-anchor="middle" class="sublabel">See DB tables panel →</text>

  <!-- RabbitMQ -->
  <rect x="300" y="308" width="200" height="48" class="queue"/>
  <text x="400" y="326" text-anchor="middle" class="label">RabbitMQ</text>
  <text x="400" y="344" text-anchor="middle" class="sublabel">session-events (topic)</text>

  <!-- Reward Worker -->
  <rect x="80" y="372" width="140" height="48" class="box"/>
  <text x="150" y="390" text-anchor="middle" class="label">Reward Worker</text>
  <text x="150" y="404" text-anchor="middle" class="sublabel">Daily goal, contributions</text>
  <text x="150" y="414" text-anchor="middle" class="sublabel">(consumes session events)</text>

  <!-- Postgres Rewards -->
  <rect x="80" y="436" width="140" height="40" class="infra"/>
  <text x="150" y="454" text-anchor="middle" class="label">PostgreSQL (rewards)</text>
  <text x="150" y="468" text-anchor="middle" class="sublabel">See DB tables panel →</text>

  <!-- Notification API -->
  <rect x="380" y="372" width="160" height="48" class="box"/>
  <text x="460" y="390" text-anchor="middle" class="label">Notification API</text>
  <text x="460" y="404" text-anchor="middle" class="sublabel">SignalR, email</text>
  <text x="460" y="414" text-anchor="middle" class="sublabel">(session shared)</text>

  <!-- Flows: Client -> Gateway -->
  <path d="M400 88 L400 96" class="flow"/>
  <text x="415" y="94" class="sublabel">HTTP</text>

  <!-- Gateway -> Keycloak (auth) -->
  <path d="M340 120 L220 184" class="flow"/>
  <text x="265" y="148" class="sublabel">OIDC</text>

  <!-- Gateway -> Session API -->
  <path d="M400 144 L400 168" class="flow"/>
  <text x="415" y="162" class="sublabel">API + Bearer</text>

  <!-- Session API -> Postgres -->
  <path d="M400 220 L400 244" class="flow"/>
  <text x="415" y="236" class="sublabel">EF Core</text>

  <!-- Session API -> RabbitMQ (outbox) -->
  <path d="M400 220 L400 308" class="flow-msg"/>
  <text x="415" y="268" class="sublabel">events</text>

  <!-- RabbitMQ -> Reward Worker -->
  <path d="M300 332 L220 372" class="flow-msg"/>
  <text x="252" y="352" class="sublabel">SessionCreated/Updated/Deleted</text>

  <!-- RabbitMQ -> Notification API -->
  <path d="M500 332 L460 372" class="flow-msg"/>
  <text x="478" y="352" class="sublabel">SessionShared</text>

  <!-- Reward Worker -> Postgres Rewards -->
  <path d="M150 420 L150 436" class="flow"/>
  <text x="165" y="432" class="sublabel">EF Core</text>

  <!-- Reward Worker -> Session API (daily goal) -->
  <path d="M220 396 L320 220" class="flow"/>
  <text x="265" y="302" class="sublabel">PATCH daily-goal-achieved</text>

  <!-- Legend (moved right so it does not overlap SessionShared label) -->
  <rect x="620" y="258" width="200" height="92" fill="#fafafa" stroke="#ccc" rx="4"/>
  <text x="720" y="276" text-anchor="middle" class="label">Legend</text>
  <line x1="630" y1="286" x2="650" y2="286" class="flow"/>
  <text x="655" y="290" class="sublabel">HTTP / sync</text>
  <line x1="630" y1="300" x2="650" y2="300" class="flow-msg"/>
  <text x="655" y="304" class="sublabel">Async (RabbitMQ)</text>
  <rect x="630" y="314" width="20" height="12" class="box"/>
  <text x="655" y="324" class="sublabel">.NET service</text>
  <rect x="630" y="328" width="20" height="12" class="infra"/>
  <text x="655" y="338" class="sublabel">Infrastructure</text>

  <!-- DB Tables panel (moved left, wider so text fits) -->
  <rect x="750" y="40" width="370" height="440" fill="#fafafa" stroke="#999" rx="4"/>
  <text x="935" y="62" text-anchor="middle" class="label" font-size="13">DB tables (reference)</text>

  <!-- PostgreSQL (sessions) -->
  <text x="765" y="88" class="tbl-title">PostgreSQL (sessions)</text>
  <text x="765" y="106" class="tbl-row">Sessions – focus sessions (user, topic, duration, mode)</text>
  <text x="765" y="120" class="tbl-row">DomainEventOutbox – events to publish to RabbitMQ</text>
  <text x="765" y="134" class="tbl-row">SessionShares – session sharing (owner, recipient)</text>
  <text x="765" y="148" class="tbl-row">SessionPublicLinks – public links for sessions</text>
  <text x="765" y="162" class="tbl-row">SessionShareAudits – audit log for share actions</text>
  <text x="765" y="176" class="tbl-row">UserStatuses – user status (Active/Suspended/Deactivated)</text>
  <text x="765" y="190" class="tbl-row">UserStatusAudits – audit log for status changes</text>
  <text x="765" y="204" class="tbl-row">MonthlyFocusSummaries – read model: total focus min per user/month</text>

  <!-- PostgreSQL (rewards) -->
  <text x="765" y="232" class="tbl-title">PostgreSQL (rewards)</text>
  <text x="765" y="250" class="tbl-row">DailyFocusContributions – per-user, per-day focus minutes</text>
  <text x="765" y="264" class="tbl-row">DailyGoalAchievements – per-user, per-day daily goal achieved</text>
</svg>
