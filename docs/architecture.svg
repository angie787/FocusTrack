<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 520" font-family="Segoe UI, sans-serif" font-size="12">
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <path d="M0,0 L8,4 L0,8 Z" fill="#333"/>
    </marker>
    <style>
      .box { fill: #e8f4f8; stroke: #2d6a9f; stroke-width: 1.5; rx: 4; }
      .infra { fill: #f0f0f0; stroke: #666; stroke-width: 1.5; rx: 4; }
      .queue { fill: #fff3e0; stroke: #e65100; stroke-width: 1.5; rx: 4; }
      .label { fill: #111; font-weight: 600; }
      .sublabel { fill: #444; font-size: 10; }
      .flow { stroke: #1976d2; stroke-width: 1.5; fill: none; marker-end: url(#arrow); }
      .flow-msg { stroke: #6a1b9a; stroke-width: 1.5; fill: none; marker-end: url(#arrow); stroke-dasharray: 4 2; }
    </style>
  </defs>
  <!-- Title -->
  <text x="400" y="22" text-anchor="middle" class="label" font-size="14">FocusTrack â€“ High-level architecture</text>

  <!-- Client -->
  <rect x="340" y="40" width="120" height="36" class="box"/>
  <text x="400" y="58" text-anchor="middle" class="label">Client (browser / Postman)</text>
  <text x="400" y="70" text-anchor="middle" class="sublabel">Bearer or cookie auth</text>

  <!-- Gateway -->
  <rect x="340" y="100" width="120" height="44" class="box"/>
  <text x="400" y="118" text-anchor="middle" class="label">Gateway (BFF)</text>
  <text x="400" y="132" text-anchor="middle" class="sublabel">OIDC, Cookie/Bearer, reverse proxy</text>

  <!-- Keycloak -->
  <rect x="120" y="168" width="100" height="36" class="infra"/>
  <text x="170" y="188" text-anchor="middle" class="label">Keycloak</text>
  <text x="170" y="198" text-anchor="middle" class="sublabel">OIDC (auth)</text>

  <!-- Session API -->
  <rect x="320" y="168" width="160" height="48" class="box"/>
  <text x="400" y="188" text-anchor="middle" class="label">Session API</text>
  <text x="400" y="202" text-anchor="middle" class="sublabel">Sessions, sharing, admin, outbox</text>

  <!-- Postgres Sessions -->
  <rect x="320" y="240" width="160" height="36" class="infra"/>
  <text x="400" y="258" text-anchor="middle" class="label">PostgreSQL (sessions)</text>
  <text x="400" y="270" text-anchor="middle" class="sublabel">Sessions, DomainEventOutbox, UserStatuses</text>

  <!-- RabbitMQ -->
  <rect x="320" y="300" width="160" height="40" class="queue"/>
  <text x="400" y="318" text-anchor="middle" class="label">RabbitMQ</text>
  <text x="400" y="332" text-anchor="middle" class="sublabel">session-events (topic)</text>

  <!-- Reward Worker -->
  <rect x="80" y="368" width="140" height="44" class="box"/>
  <text x="150" y="388" text-anchor="middle" class="label">Reward Worker</text>
  <text x="150" y="402" text-anchor="middle" class="sublabel">Daily goal, contributions</text>

  <!-- Postgres Rewards -->
  <rect x="80" y="436" width="140" height="32" class="infra"/>
  <text x="150" y="454" text-anchor="middle" class="label">PostgreSQL (rewards)</text>

  <!-- Notification API -->
  <rect x="380" y="368" width="140" height="44" class="box"/>
  <text x="450" y="388" text-anchor="middle" class="label">Notification API</text>
  <text x="450" y="402" text-anchor="middle" class="sublabel">SignalR, email (session shared)</text>

  <!-- Jaeger (optional) -->
  <rect x="600" y="168" width="80" height="32" class="infra"/>
  <text x="640" y="186" text-anchor="middle" class="label">Jaeger</text>
  <text x="640" y="196" text-anchor="middle" class="sublabel">Tracing</text>

  <!-- Flows: Client -> Gateway -->
  <path d="M400 76 L400 100" class="flow"/>
  <text x="415" y="92" class="sublabel">HTTP</text>

  <!-- Gateway -> Keycloak (auth) -->
  <path d="M340 122 L220 184" class="flow"/>
  <text x="265" y="148" class="sublabel">OIDC</text>

  <!-- Gateway -> Session API -->
  <path d="M400 144 L400 168" class="flow"/>
  <text x="415" y="158" class="sublabel">API + Bearer</text>

  <!-- Session API -> Postgres -->
  <path d="M400 216 L400 240" class="flow"/>
  <text x="415" y="232" class="sublabel">EF Core</text>

  <!-- Session API -> RabbitMQ (outbox) -->
  <path d="M400 216 L400 300" class="flow-msg"/>
  <text x="415" y="262" class="sublabel">events</text>

  <!-- RabbitMQ -> Reward Worker -->
  <path d="M320 320 L220 368" class="flow-msg"/>
  <text x="260" y="348" class="sublabel">SessionCreated/Updated/Deleted</text>

  <!-- RabbitMQ -> Notification API -->
  <path d="M400 320 L450 368" class="flow-msg"/>
  <text x="420" y="348" class="sublabel">SessionShared</text>

  <!-- Reward Worker -> Postgres Rewards -->
  <path d="M150 412 L150 436" class="flow"/>
  <text x="165" y="428" class="sublabel">EF Core</text>

  <!-- Reward Worker -> Session API (daily goal) -->
  <path d="M220 390 L320 216" class="flow"/>
  <text x="265" y="300" class="sublabel">PATCH daily-goal-achieved</text>

  <!-- Legend -->
  <rect x="540" y="320" width="200" height="72" fill="#fafafa" stroke="#ccc" rx="4"/>
  <text x="640" y="338" text-anchor="middle" class="label">Legend</text>
  <line x1="550" y1="348" x2="570" y2="348" class="flow"/>
  <text x="575" y="352" class="sublabel">HTTP / sync</text>
  <line x1="550" y1="362" x2="570" y2="362" class="flow-msg"/>
  <text x="575" y="366" class="sublabel">Async (RabbitMQ)</text>
  <rect x="550" y="376" width="20" height="12" class="box"/>
  <text x="575" y="386" class="sublabel">.NET service</text>
  <rect x="550" y="390" width="20" height="12" class="infra"/>
  <text x="575" y="400" class="sublabel">Infrastructure</text>
</svg>
